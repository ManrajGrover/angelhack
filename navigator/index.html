<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Title</title>
        <meta name="description" content="A privileged app stub">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/materialize.min.css" media="screen,projection">
        <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/app.js" ></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <link rel="prefetch" type="application/l10n" href="data/locales.ini" />
        <script type="text/javascript" src="js/libs/l10n.js"></script>
        <script type="text/javascript">
            $( document ).ready( function() {
                $("#login_b").click( function(){
                    var login_packet ={
                        "_id": $("#email").val(),
                        "pass": $("#password").val()
                    };
                    console.log(login_packet);
                    var xhr = new XMLHttpRequest({mozSystem:true});
                    xhr.open("POST", "http://localhost:5000/api/login", false);
                    // xhr.setRequestHeader("Access-Control-Allow-Origin","*");
                    xhr.send(JSON.stringify(login_packet));
                    var x= JSON.parse(xhr.responseText) ;
                    if(x.loggedIn == true){
                        console.log("Login successful, redirecting to home.html");
                        //console.log(xhr.responseText);
                        localStorage.setItem("uid",$("#email").val());
                        localStorage.setItem("token", x.token);
                        //console.log('hey'+localStorage.getItem('username'));
                        window.location = "choices.html";
                    }
                    else{
                        console.log("Login unsuccessful, show the message");
                        $('#login').append("Login not successful, Please try again.");
                        $('#email').addClass('invalid');
                        $('#password').addClass('invalid');
                    }
                });
            });
        </script>
    </head>
    <body>
        <section class="container">
            <div class="row">
                <div class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="email" type="email" class="validate">
                                <label for="email">Email</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="password" type="password" class="validate"/>
                                <label for="password">Password</label>
                            </div>
                        </div>
                        <button id="login_b" class="btn waves-effect waves-light teal green darken-1" type="submit" name="action">Log in
                            <i class="mdi-content-send right"></i>
                        </input>
                </div>
              </div>
        </section>
    </body>
</html>